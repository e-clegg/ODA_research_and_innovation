filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = lapply(receiver_organisation.narrative, `[[`, 1))
# Unnest country information -----
transactions_countries <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[[`, 1))
transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative)
transactions_countries <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1))
# Unnest country information -----
transactions_countries <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[[`, 1))
# Unnest country information -----
transactions_countries <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_org, `[[`, 1))
transactions_countries <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_org, `[[`, 1)) %>%
mutate(receiver_org = str_replace_all, "NULL", "") %>%
select(-receiver_organisation.narrative)
transactions_countries <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_org, `[[`, 1)) %>%
mutate(receiver_org = str_replace_all(receiver_org, "NULL", "")) %>%
select(-receiver_organisation.narrative)
transactions_countries <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = coalesce(map(receiver_org, `[[`, 1)), "")
transactions_countries <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_org, `[[`, 1)) %>%
select(-receiver_organisation.narrative)
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_org, `[[`, 1)) %>%
select(-receiver_organisation.narrative) %>%
unique()
# Summarise country and organisation information -----
transactions_country %>% transactions_unnest %>%
group_by(iati_identifier) %>%
summarise(recipient_country = paste(coalesce(recipient_country, ""), collapse = ", "),
recipient_org = paste(coalesce(receiver_org, ""), collapse = ", "))
# Unnest transaction information -----
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_org, `[[`, 1)) %>%
select(-receiver_organisation.narrative) %>%
unique()
# Summarise country and organisation information -----
transactions_country %>% transactions_unnest %>%
group_by(iati_identifier) %>%
summarise(recipient_country = paste(coalesce(recipient_country, ""), collapse = ", "),
recipient_org = paste(coalesce(receiver_org, ""), collapse = ", "))
# Summarise country and organisation information -----
transactions_country <- transactions_unnest %>%
group_by(iati_identifier) %>%
summarise(recipient_country = paste(coalesce(recipient_country, ""), collapse = ", "),
recipient_org = paste(coalesce(receiver_org, ""), collapse = ", "))
View(transactions_unnest)
# Summarise country and organisation information -----
transactions_country <- transactions_unnest %>%
group_by(iati_identifier) %>%
summarise(recipient_org = paste(coalesce(receiver_org, ""), collapse = ", "))
# Unnest transaction information -----
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_org, `[[`, 1)) %>%
mutate(receiver_org = map(receiver_org, `[[`, 1)) %>%
select(-receiver_organisation.narrative) %>%
unique()
View(transactions_unnest)
# Unnest transaction information -----
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_org, unlist)) %>%
select(-receiver_organisation.narrative) %>%
unique()
View(transactions_unnest)
# Unnest transaction information -----
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[[`, 1)) %>%
select(-receiver_organisation.narrative) %>%
unique()
# Unnest transaction information -----
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_org, `[[`, 1)) %>%
select(-receiver_organisation.narrative) %>%
unique()
# Unnest transaction information -----
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_org, `[[`, 1)) %>%
mutate(receiver_org = map(receiver_org, unlist)) %>%
select(-receiver_organisation.narrative) %>%
unique()
View(transactions_unnest)
# Unnest transaction information -----
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_org, `[[`, 1)) %>%
unnest(cols = receiver_org)
select(-receiver_organisation.narrative) %>%
unique()
# Unnest transaction information -----
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_org, `[[`, 1)) %>%
unnest(cols = receiver_org) %>%
select(-receiver_organisation.narrative) %>%
unique()
# Unnest transaction information -----
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
unnest(cols = receiver_org) %>%
select(-receiver_organisation.narrative) %>%
unique()
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1))
View(transactions_unnest)
# Unnest transaction information -----
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
filter(lengths(receiver_org) != 0) %>%
unnest(cols = receiver_org) %>%
select(-receiver_organisation.narrative) %>%
unique()
# Unnest transaction information -----
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[[`, 1)) %>%
unnest(cols = receiver_org) %>%
select(-receiver_organisation.narrative) %>%
unique()
# Unnest transaction information -----
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_org, `[[`, 1)) %>%
unnest(cols = receiver_org) %>%
select(-receiver_organisation.narrative) %>%
unique()
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country))
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative)
transactions_unnest <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
# remove transactions without a country
filter(!is.na(recipient_country)) %>%
# unnest country info
unnest(cols = description.narrative) %>%
select(iati_identifier, transaction_date, recipient_country,
value, currency.code, text, receiver_organisation.narrative) %>%
mutate(receiver_org = map(receiver_organisation.narrative, `[`, 1)) %>%
mutate(receiver_org = map(receiver_org, `[[`, 1)) %>%
unnest(cols = receiver_org) %>%
select(-receiver_organisation.narrative) %>%
unique()
# Unnest country information -----
transactions_country <- transaction_list %>%
filter(lengths(recipient_countries) != 0) %>%
unnest(cols = recipient_countries) %>%
select(-country.url, -recipient_regions) %>%
rename(recipient_country = country.name) %>%
filter(!is.na(recipient_country)) %>%
group_by(iati_identifier) %>%
summarise(recipient_country = paste(coalesce(recipient_country, ""), collapse = ", "))
View(transactions_country)
# Unnest description information -----
transactions_description <- transaction_list %>%
filter(iati_identifier %in% transactions_country) %>%
unnest(cols = description.narrative)
transactions_description <- transaction_list %>%
filter(iati_identifier %in% transactions_country)
# Unnest description information -----
transactions_description <- transaction_list %>%
filter(iati_identifier %in% transactions_country$iati_identifier) %>%
unnest(cols = description.narrative)
View(transactions_description)
# Unnest description information -----
transactions_description <- transaction_list %>%
filter(iati_identifier %in% transactions_country$iati_identifier) %>%
unnest(cols = description.narrative) %>%
rename(description = text) %>%
filter(!is.na(description)) %>%
group_by(iati_identifier) %>%
summarise(descriptions = paste(description, collapse = "\n"))
transactions_description <- transaction_list %>%
filter(iati_identifier %in% transactions_country$iati_identifier) %>%
unnest(cols = description.narrative) %>%
rename(description = text) %>%
filter(!is.na(description)) %>%
group_by(iati_identifier)
# Unnest description information -----
transactions_description <- transaction_list %>%
filter(iati_identifier %in% transactions_country$iati_identifier) %>%
unnest(cols = description.narrative)
# Unnest description information -----
transactions_description <- transaction_list %>%
filter(iati_identifier %in% transactions_country$iati_identifier) %>%
unnest(cols = description.narrative) %>%
rename(description = text)
# Unnest description information -----
transactions_description <- transaction_list %>%
filter(iati_identifier %in% transactions_country$iati_identifier) %>%
unnest(cols = description.narrative) %>%
rename(transaction_description = text) %>%
filter(!is.na(transaction_description)) %>%
group_by(iati_identifier) %>%
summarise(descriptions = paste(transaction_description, collapse = "\n"))
# Unnest description information -----
transactions_description <- transaction_list %>%
filter(iati_identifier %in% transactions_country$iati_identifier) %>%
unnest(cols = description.narrative) %>%
rename(transaction_description = text) %>%
filter(!is.na(transaction_description)) %>%
group_by(iati_identifier) %>%
summarise(descriptions = paste(transaction_description, collapse = "; "))
# Unnest recipient org information -----
transactions_orgs <- transaction_list %>%
filter(iati_identifier %in% transactions_country$iati_identifier)
View(transactions_orgs)
transactions_orgs <- transaction_list %>%
filter(iati_identifier %in% transactions_country$iati_identifier) %>%
unnest(cols = receiver_organisation.narrative) %>%
# Unnest recipient org information -----
transactions_orgs <- transaction_list %>%
filter(iati_identifier %in% transactions_country$iati_identifier) %>%
unnest(cols = receiver_organisation.narrative)
transactions_orgs <- transaction_list %>%
filter(iati_identifier %in% transactions_country$iati_identifier) %>%
filter(lengths(receiver_organisation.narrative) != 0) %>%
unnest(cols = receiver_organisation.narrative)
transactions_orgs <- transaction_list %>%
filter(iati_identifier %in% transactions_country$iati_identifier) %>%
filter(lengths(receiver_organisation.narrative) != 0) %>%
unnest(cols = receiver_organisation.narrative) %>%
rename(receiver_org = text)
# Unnest recipient org information -----
transactions_orgs <- transaction_list %>%
filter(iati_identifier %in% transactions_country$iati_identifier) %>%
filter(lengths(receiver_organisation.narrative) != 0) %>%
unnest(cols = receiver_organisation.narrative) %>%
rename(receiver_org = text) %>%
group_by(iati_identifier) %>%
summarise(receiver_orgs = paste(receiver_org, collapse = ", "))
# Unnest recipient org information -----
transactions_orgs <- transaction_list %>%
filter(iati_identifier %in% transactions_country$iati_identifier) %>%
filter(lengths(receiver_organisation.narrative) != 0) %>%
unnest(cols = receiver_organisation.narrative) %>%
rename(receiver_org = text) %>%
select(iati_identifier, receiver_org) %>%
unique() %>%
group_by(iati_identifier) %>%
summarise(receiver_orgs = paste(receiver_org, collapse = ", "))
